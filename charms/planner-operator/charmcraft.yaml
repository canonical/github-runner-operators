# This file configures Charmcraft.
# See https://juju.is/docs/sdk/charmcraft-config for guidance.
# For questions or help, visit https://matrix.to/#/#12-factor-charms:ubuntu.com

name: github-runner-planner

type: charm

# the platforms this charm should be built on and run on.
# you can check your architecture with `dpkg --print-architecture`
base: ubuntu@24.04
platforms:
  amd64:

# (Required)
summary: Provides planner API service.

# (Required)
description: |
  Provides a HTTP REST API for GitHub runner charm and operations management.
extensions:
  - go-framework

requires:
  rabbitmq:
    interface: rabbitmq
    optional: false
    limit: 1
  tracing:
    interface: tracing
    optional: true
    limit: 1
  postgresql:
    interface: postgresql_client
    optional: false
    limit: 1
  planner:
    interface: github_runner_planner_v0

config:
  options:
    admin-token:
      type: secret
      description: |
        Planner admin token used to create/delete general auth tokens.
        It must start with 'planner_v0_' followed by exactly 20 characters that can be letters,
        numbers, hyphens (-), or underscores (_). To generate the token, you can run `echo "planner_v0_$(uuidgen | tr -d '-' | tr '[:upper:]' '[:lower:]' | head -c 20)"`

actions:
  enable-flavor:
    description: Enable a specific flavor
    params:
      flavor:
        type: string
        description: Name of the flavor to enable
    required: [flavor]
    additionalProperties: false
  disable-flavor:
    description: Disable a specific flavor
    params:
      flavor:
        type: string
        description: Name of the flavor to disable
    required: [flavor]
    additionalProperties: false

name: webhook-gateway
base: bare
build-base: ubuntu@24.04
version: '0.1'
summary: Receive and forward GitHub webhooks to a MQ
description: |
  This application provides a WebService that receives GitHub webhooks and forwards
  them to an AMQP-0.9-1 compatible message broker.
platforms:
  amd64:

# to ensure the go-framework extension functions properly, your Go project
# should have a go.mod file. Check the parts section for the selection of
# the default binary.
# see https://documentation.ubuntu.com/rockcraft/en/latest/reference/extensions/go-framework
# for more information.
# +-- webhook_gateway
# |   |-- go.mod
# |   |-- migrate.sh

extensions:
    - go-framework

# Configure the go-framework extension to build from cmd/webhook-gateway
parts:
  go-framework/install-app:
    override-build: |
      # Build the webhook-gateway binary from cmd/webhook-gateway
      cd "$CRAFT_PART_SRC"
      go build -o bin/webhook-gateway ./cmd/webhook-gateway
      mkdir -p "$CRAFT_PART_INSTALL/usr/local/bin"
      cp bin/webhook-gateway "$CRAFT_PART_INSTALL/usr/local/bin/"

